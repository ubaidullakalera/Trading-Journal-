<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trading Journal</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6.26.0/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const TradingJournalApp = () => {
      const [trades, setTrades] = useState([]);
      const [newTrade, setNewTrade] = useState({
        account: '',
        date: '',
        tradingTime: '',
        customTradingTime: '',
        instrument: '',
        londonSessionOnly: false,
        checkedTimeframes: false,
        usedStopLossTakeProfit: false,
        fibonacciSetupTimeframe: '',
        fibonacciEntryLevel: '',
        profitLoss: '',
        capitalAmount: '',
        attachedPhoto: null
      });
      const [editingIndex, setEditingIndex] = useState(null);
      const [isSidebarOpen, setIsSidebarOpen] = useState(false);
      const [view, setView] = useState('add');
      const [filterAccount, setFilterAccount] = useState('All');
      const [previewImage, setPreviewImage] = useState(null);

      // Trading time options
      const newTimeSlots = [
        '12:00 AM - 6:00 AM',
        '6:00 AM - 10:00 AM',
        '10:00 AM - 3:00 PM',
        '3:00 PM - 8:00 PM',
        '8:00 PM - 12:00 AM',
        'Other'
      ];

      // Load trades from localStorage on mount
      useEffect(() => {
        const savedTrades = localStorage.getItem('trades');
        if (savedTrades) {
          setTrades(JSON.parse(savedTrades));
        }
      }, []);

      // Save trades to localStorage whenever trades change
      useEffect(() => {
        localStorage.setItem('trades', JSON.stringify(trades));
      }, [trades]);

      // Handle input changes
      const handleInputChange = (e) => {
        const { name, value, type, checked } = e.target;
        setNewTrade({ ...newTrade, [name]: type === 'checkbox' ? checked : value });
      };

      // Handle image upload
      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            setNewTrade({ ...newTrade, attachedPhoto: event.target.result });
            setPreviewImage(event.target.result);
          };
          reader.readAsDataURL(file);
        }
      };

      // Remove image
      const handleRemoveImage = () => {
        setNewTrade({ ...newTrade, attachedPhoto: null });
        setPreviewImage(null);
        document.getElementById('attachedPhoto').value = '';
      };

      // Add or update trade
      const handleAddTrade = () => {
        const tradingTime = newTrade.tradingTime === 'Other' ? newTrade.customTradingTime : newTrade.tradingTime;
        if (!newTrade.account || !newTrade.date || !tradingTime || !newTrade.instrument || !newTrade.capitalAmount) {
          alert('Please fill in Account, Date, Trading Time, Instrument, and Capital Amount');
          return;
        }
        const currency = newTrade.account === 'Personal' ? 'AED' : newTrade.account === 'Client' ? 'INR' : 'USD';
        const timeZone = newTrade.account === 'Client' ? 'IST' : 'GST';
        const tradeData = {
          account: newTrade.account,
          date: newTrade.date,
          tradingTime: newTrade.tradingTime === 'Other' ? `${tradingTime} (${timeZone})` : `${newTrade.tradingTime} (${timeZone})`,
          instrument: newTrade.instrument,
          londonSessionOnly: newTrade.londonSessionOnly,
          checkedTimeframes: newTrade.checkedTimeframes,
          usedStopLossTakeProfit: newTrade.usedStopLossTakeProfit,
          fibonacciSetupTimeframe: newTrade.fibonacciSetupTimeframe,
          fibonacciEntryLevel: newTrade.fibonacciEntryLevel,
          profitLoss: newTrade.profitLoss ? `${newTrade.profitLoss} ${currency}` : '',
          capitalAmount: `${newTrade.capitalAmount} ${currency}`,
          attachedPhoto: newTrade.attachedPhoto,
          id: editingIndex !== null ? trades[editingIndex].id : Date.now()
        };
        if (editingIndex !== null) {
          const updatedTrades = [...trades];
          updatedTrades[editingIndex] = tradeData;
          setTrades(updatedTrades);
          setEditingIndex(null);
        } else {
          setTrades([...trades, tradeData]);
        }
        setNewTrade({
          account: '',
          date: '',
          tradingTime: '',
          customTradingTime: '',
          instrument: '',
          londonSessionOnly: false,
          checkedTimeframes: false,
          usedStopLossTakeProfit: false,
          fibonacciSetupTimeframe: '',
          fibonacciEntryLevel: '',
          profitLoss: '',
          capitalAmount: '',
          attachedPhoto: null
        });
        setPreviewImage(null);
        document.getElementById('attachedPhoto').value = '';
      };

      // Edit trade
      const handleEditTrade = (index) => {
        const trade = trades[index];
        const isCustomTime = !newTimeSlots.includes(trade.tradingTime.split(' (')[0]);
        setNewTrade({
          account: trade.account,
          date: trade.date,
          tradingTime: isCustomTime ? 'Other' : trade.tradingTime.split(' (')[0],
          customTradingTime: isCustomTime ? trade.tradingTime.split(' (')[0] : '',
          instrument: trade.instrument,
          londonSessionOnly: trade.londonSessionOnly,
          checkedTimeframes: trade.checkedTimeframes,
          usedStopLossTakeProfit: trade.usedStopLossTakeProfit,
          fibonacciSetupTimeframe: trade.fibonacciSetupTimeframe,
          fibonacciEntryLevel: trade.fibonacciEntryLevel,
          profitLoss: trade.profitLoss.split(' ')[0] || '',
          capitalAmount: trade.capitalAmount.split(' ')[0] || '',
          attachedPhoto: trade.attachedPhoto
        });
        setPreviewImage(trade.attachedPhoto);
        setEditingIndex(index);
        setView('add');
      };

      // Delete trade
      const handleDeleteTrade = (index) => {
        if (window.confirm('Are you sure you want to delete this trade?')) {
          setTrades(trades.filter((_, i) => i !== index));
        }
      };

      // Export trades as JSON
      const handleExport = () => {
        const dataStr = JSON.stringify(trades, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'trading_journal.json';
        link.click();
        URL.revokeObjectURL(url);
      };

      // Import trades from JSON
      const handleImport = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const importedTrades = JSON.parse(event.target.result);
            setTrades(importedTrades);
            alert('Trades imported successfully!');
          } catch (error) {
            alert('Error importing trades. Please ensure the file is a valid JSON.');
          }
        };
        reader.readAsText(file);
      };

      // Filter trades by account
      const filteredTrades = filterAccount === 'All' ? trades : trades.filter(trade => trade.account === filterAccount);

      return (
        <div className="flex min-h-screen">
          {/* Sidebar */}
          <div className={`fixed inset-y-0 left-0 w-64 bg-gray-800 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 transition-transform duration-300 ease-in-out z-50`}>
            <div className="p-4">
              <h2 className="text-2xl font-bold text-white">Trading Journal</h2>
            </div>
            <nav className="mt-4">
              <button
                onClick={() => { setView('add'); setIsSidebarOpen(false); }}
                className={`w-full text-left px-4 py-2 ${view === 'add' ? 'bg-blue-600' : 'hover:bg-gray-700'}`}
              >
                Add Trade
              </button>
              <button
                onClick={() => { setView('view'); setIsSidebarOpen(false); }}
                className={`w-full text-left px-4 py-2 ${view === 'view' ? 'bg-blue-600' : 'hover:bg-gray-700'}`}
              >
                View Trades
              </button>
              <button
                onClick={() => { setView('export'); setIsSidebarOpen(false); }}
                className={`w-full text-left px-4 py-2 ${view === 'export' ? 'bg-blue-600' : 'hover:bg-gray-700'}`}
              >
                Export/Import
              </button>
            </nav>
          </div>

          {/* Main Content */}
          <div className="flex-1 flex flex-col">
            {/* Header */}
            <header className="bg-gradient-to-r from-blue-600 to-purple-600 p-4 flex justify-between items-center">
              <button className="md:hidden text-white" onClick={() => setIsSidebarOpen(true)}>
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </button>
              <h1 className="text-2xl font-bold">Trading Journal</h1>
              <div></div>
            </header>

            {/* Content */}
            <main className="flex-1 p-6 max-w-4xl mx-auto w-full">
              {view === 'add' && (
                <div className="bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
                  <h2 className="text-xl font-semibold mb-4">{editingIndex !== null ? 'Edit Trade' : 'Add New Trade'}</h2>
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <select
                      name="account"
                      value={newTrade.account}
                      onChange={handleInputChange}
                      className="p-2 border rounded-md bg-gray-700 text-white w-full"
                      required
                    >
                      <option value="">Select Account</option>
                      <option value="Personal">Personal (AED)</option>
                      <option value="Client">Client (INR)</option>
                      <option value="Funded Account">Funded Account (USD)</option>
                    </select>
                    <input
                      type="date"
                      name="date"
                      value={newTrade.date}
                      onChange={handleInputChange}
                      className="p-2 border rounded-md bg-gray-700 text-white w-full"
                      required
                    />
                    <div></div> {/* Placeholder for grid alignment */}
                    <div>
                      <select
                        name="tradingTime"
                        value={newTrade.tradingTime}
                        onChange={handleInputChange}
                        className="p-2 border rounded-md bg-gray-700 text-white w-full"
                        required
                      >
                        <option value="">Select Trading Time</option>
                        {newTrade.account === 'Client' ? (
                          newTimeSlots.map(time => (
                            <option key={time} value={time}>{time} (IST)</option>
                          ))
                        ) : (
                          newTimeSlots.map(time => (
                            <option key={time} value={time}>{time} (GST)</option>
                          ))
                        )}
                      </select>
                      {newTrade.tradingTime === 'Other' && (
                        <input
                          type="text"
                          name="customTradingTime"
                          value={newTrade.customTradingTime}
                          onChange={handleInputChange}
                          placeholder={`Custom Trading Time (e.g., ${newTrade.account === 'Client' ? '1:00 PM - 2:00 PM IST' : '1:00 PM - 2:00 PM GST'})`}
                          className="mt-2 p-2 border rounded-md bg-gray-700 text-white w-full"
                        />
                      )}
                    </div>
                    <select
                      name="instrument"
                      value={newTrade.instrument}
                      onChange={handleInputChange}
                      className="p-2 border rounded-md bg-gray-700 text-white w-full"
                      required
                    >
                      <option value="">Select Instrument</option>
                      <option value="XAUUSD">XAUUSD</option>
                      <option value="BTCUSD">BTCUSD</option>
                      <option value="ETHUSD">ETHUSD</option>
                      <option value="EURUSD">EURUSD</option>
                      <option value="USDJPY">USDJPY</option>
                    </select>
                    <div></div> {/* Placeholder for grid alignment */}
                    <div className="col-span-4">
                      <label className="block text-sm mb-1">Trading Rules</label>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                        <label className="flex items-center">
                          <input
                            type="checkbox"
                            name="londonSessionOnly"
                            checked={newTrade.londonSessionOnly}
                            onChange={handleInputChange}
                            className="mr-2"
                          />
                          London Session Only
                        </label>
                        <label className="flex items-center">
                          <input
                            type="checkbox"
                            name="checkedTimeframes"
                            checked={newTrade.checkedTimeframes}
                            onChange={handleInputChange}
                            className="mr-2"
                          />
                          Checked D TF, 1H TF, 15M TF
                        </label>
                        <label className="flex items-center">
                          <input
                            type="checkbox"
                            name="usedStopLossTakeProfit"
                            checked={newTrade.usedStopLossTakeProfit}
                            onChange={handleInputChange}
                            className="mr-2"
                          />
                          Used Stop Loss and Take Profit
                        </label>
                      </div>
                    </div>
                    <select
                      name="fibonacciSetupTimeframe"
                      value={newTrade.fibonacciSetupTimeframe}
                      onChange={handleInputChange}
                      className="p-2 border rounded-md bg-gray-700 text-white w-full"
                      required
                    >
                      <option value="">Select Fibonacci Setup Timeframe</option>
                      <option value="Daily">Daily</option>
                      <option value="1H">1H</option>
                      <option value="15M">15M</option>
                    </select>
                    <select
                      name="fibonacciEntryLevel"
                      value={newTrade.fibonacciEntryLevel}
                      onChange={handleInputChange}
                      className="p-2 border rounded-md bg-gray-700 text-white w-full"
                      required
                    >
                      <option value="">Select Fibonacci Level</option>
                      <option value="50%">50%</option>
                      <option value="62%">62%</option>
                      <option value="78.60%">78.60%</option>
                    </select>
                    <div></div> {/* Placeholder for grid alignment */}
                    <input
                      type="number"
                      name="profitLoss"
                      value={newTrade.profitLoss}
                      onChange={handleInputChange}
                      placeholder={`Profit & Loss (${newTrade.account === 'Personal' ? 'AED' : newTrade.account === 'Client' ? 'INR' : 'USD'})`}
                      className="p-2 border rounded-md bg-gray-700 text-white w-[100px] flex-shrink-0"
                    />
                    <input
                      type="number"
                      name="capitalAmount"
                      value={newTrade.capitalAmount}
                      onChange={handleInputChange}
                      placeholder={`Capital Amount (${newTrade.account === 'Personal' ? 'AED' : newTrade.account === 'Client' ? 'INR' : 'USD'})`}
                      className="p-2 border rounded-md bg-gray-700 text-white w-[100px] flex-shrink-0"
                      required
                    />
                    <div>
                      <label className="block text-sm mb-1">Attached Photo</label>
                      <input
                        id="attachedPhoto"
                        type="file"
                        accept="image/*"
                        onChange={handleImageUpload}
                        className="p-2 border rounded-md bg-gray-700 text-white w-full mb-2"
                      />
                      {previewImage && (
                        <div className="mt-2 w-[128px]">
                          <img src={previewImage} alt="Preview" className="w-32 h-32 object-cover rounded-md" />
                          <button
                            onClick={handleRemoveImage}
                            className="mt-2 bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-600"
                          >
                            Remove Image
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                  <button
                    onClick={handleAddTrade}
                    className="mt-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"
                  >
                    {editingIndex !== null ? 'Update Trade' : 'Add Trade'}
                  </button>
                </div>
              )}

              {view === 'view' && (
                <div className="bg-gray-800 p-6 rounded-lg shadow-lg">
                  <h2 className="text-xl font-semibold mb-4">Trade Log</h2>
                  <div className="mb-4">
                    <select
                      value={filterAccount}
                      onChange={(e) => setFilterAccount(e.target.value)}
                      className="p-2 border rounded-md bg-gray-700 text-white"
                    >
                      <option value="All">All Accounts</option>
                      <option value="Personal">Personal (AED)</option>
                      <option value="Client">Client (INR)</option>
                      <option value="Funded Account">Funded Account (USD)</option>
                    </select>
                  </div>
                  {filteredTrades.length === 0 ? (
                    <p className="text-gray-400">No trades recorded for this account.</p>
                  ) : (
                    <div className="overflow-x-auto">
                      <table className="w-full border-collapse">
                        <thead>
                          <tr className="bg-gray-700">
                            <th className="p-2 border border-gray-600 min-w-[100px]">Account</th>
                            <th className="p-2 border border-gray-600 min-w-[120px]">Date</th>
                            <th className="p-2 border border-gray-600 min-w-[150px]">Trading Time</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Instrument</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">London Session</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Checked Timeframes</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Stop Loss/Take Profit</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Fibonacci Setup Timeframe</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Fibonacci Level</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Profit & Loss</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Capital Amount</th>
                            <th className="p-2 border border-gray-600 min-w-[120px]">Attached Photo</th>
                            <th className="p-2 border border-gray-600 min-w-[100px]">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          {filteredTrades.map((trade, index) => (
                            <tr key={trade.id} className="hover:bg-gray-600">
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.account}</td>
                              <td className="p-2 border border-gray-600 min-w-[120px]">{trade.date}</td>
                              <td className="p-2 border border-gray-600 min-w-[150px]">{trade.tradingTime}</td>
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.instrument}</td>
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.londonSessionOnly ? 'Yes' : 'No'}</td>
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.checkedTimeframes ? 'Yes' : 'No'}</td>
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.usedStopLossTakeProfit ? 'Yes' : 'No'}</td>
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.fibonacciSetupTimeframe}</td>
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.fibonacciEntryLevel}</td>
                              <td className={`p-2 border border-gray-600 min-w-[100px] ${parseFloat(trade.profitLoss) >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                {trade.profitLoss}
                              </td>
                              <td className="p-2 border border-gray-600 min-w-[100px]">{trade.capitalAmount}</td>
                              <td className="p-2 border border-gray-600 min-w-[120px]">
                                {trade.attachedPhoto ? (
                                  <img
                                    src={trade.attachedPhoto}
                                    alt="Chart"
                                    className="w-16 h-16 object-cover rounded-md cursor-pointer"
                                    onClick={() => window.open(trade.attachedPhoto, '_blank')}
                                  />
                                ) : (
                                  'No Image'
                                )}
                              </td>
                              <td className="p-2 border border-gray-600 min-w-[100px] flex space-x-2">
                                <button
                                  onClick={() => handleEditTrade(trades.indexOf(trade))}
                                  className="bg-yellow-500 text-white px-2 py-1 rounded-md hover:bg-yellow-600"
                                >
                                  Edit
                                </button>
                                <button
                                  onClick={() => handleDeleteTrade(trades.indexOf(trade))}
                                  className="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-600"
                                >
                                  Delete
                                </button>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  )}
                </div>
              )}

              {view === 'export' && (
                <div className="bg-gray-800 p-6 rounded-lg shadow-lg">
                  <h2 className="text-xl font-semibold mb-4">Export/Import Trades</h2>
                  <div className="flex flex-col space-y-4">
                    <button
                      onClick={handleExport}
                      className="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"
                    >
                      Export Trades as JSON
                    </button>
                    <label className="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 cursor-pointer text-center">
                      Import Trades from JSON
                      <input type="file" accept=".json" onChange={handleImport} className="hidden" />
                    </label>
                  </div>
                </div>
              )}
            </main>
          </div>
        </div>
      );
    };

    ReactDOM.render(<TradingJournalApp />, document.getElementById('root'));
  </script>
</body>
</html>